
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Tutorial 2: Social Media &amp; Valuation of Landscapes &#8212; Big Data for Sustainability Sciences</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture: A guide to visualisation" href="../week7/lecture.html" />
    <link rel="prev" title="Tutorial 1: Social Media and Natural Language Processing" href="tutorial1.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Big Data for Sustainability Sciences</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course overview
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../course_basics/course_intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../course_basics/teachers.html">
   Teachers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../course_basics/schedule.html">
   Course schedule
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/lecture.html">
   Lecture: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/tutorial1.html">
   Tutorial 1: Introduction to Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/tutorial2.html">
   Tutorial 2: Introduction to NumPy and Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/tutorial3.html">
   Tutorial 3: Introduction to Data Analysis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/lecture.html">
   Lecture: Introduction to Random Forests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/tutorial1.html">
   Tutorial 1: Data Exploration and regression analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/tutorial2.html">
   Tutorial 2: Random Forest Regression
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/lecture.html">
   Lecture: Introduction to Artificial Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/tutorial1.html">
   Tutorial 1: Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/tutorial2.html">
   Tutorial 2: Model Validation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 4
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week4/lecture.html">
   Lecture: Big Data in the public domain
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week4/tutorial1.html">
   Tutorial 1: Working with OpenStreetMap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week4/tutorial2.html">
   Tutorial 2: Natural Hazard Risk Assessment
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 5
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/lecture.html">
   Lecture: Earth Observation &amp; Google Earth Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/tutorial1.html">
   Tutorial 1: Land-cover classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/tutorial2.html">
   Tutorial 2: Drought Detection
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 6
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="lecture.html">
   Lecture: Social Media and Natural Language Processing (NLP)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tutorial1.html">
   Tutorial 1: Social Media and Natural Language Processing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Tutorial 2: Social Media &amp; Valuation of Landscapes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 7
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week7/lecture.html">
   Lecture: A guide to visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week7/tutorial1.html">
   Tutorial: Visualizing your results
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 8
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week8/exam.html">
   Exam preparation
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://colab.research.google.com/github/ElcoK/BigData_AED/blob/main/week6/tutorial2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ElcoK/BigData_AED"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ElcoK/BigData_AED/issues/new?title=Issue%20on%20page%20%2Fweek6/tutorial2.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/week6/tutorial2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#important-before-we-start">
   Important before we start
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introducing-the-packages">
   1.Introducing the packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extract-data-from-flickr">
   2. Extract data from Flickr
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-data-extraction">
     Prepare data extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-extraction">
     Data extraction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#explore-the-data">
   3. Explore the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#clustering-of-data">
   4. Clustering of data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-grid-of-the-area">
     Create a grid of the area
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbscan">
     DBSCAN
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#do-people-prefer-certain-land-uses">
   5. Do people prefer certain land uses?
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Tutorial 2: Social Media & Valuation of Landscapes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#important-before-we-start">
   Important before we start
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introducing-the-packages">
   1.Introducing the packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extract-data-from-flickr">
   2. Extract data from Flickr
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-data-extraction">
     Prepare data extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-extraction">
     Data extraction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#explore-the-data">
   3. Explore the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#clustering-of-data">
   4. Clustering of data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-grid-of-the-area">
     Create a grid of the area
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbscan">
     DBSCAN
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#do-people-prefer-certain-land-uses">
   5. Do people prefer certain land uses?
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-2-social-media-valuation-of-landscapes">
<h1>Tutorial 2: Social Media &amp; Valuation of Landscapes<a class="headerlink" href="#tutorial-2-social-media-valuation-of-landscapes" title="Permalink to this headline">#</a></h1>
<p>Within this tutorial, we will work with the Flickr photo database to better understand how people value specific land use types. We will learn how to extract information from Flickr, how you can explore and visualize this, and how to use it for some basic analysis.</p>
<section id="important-before-we-start">
<h2>Important before we start<a class="headerlink" href="#important-before-we-start" title="Permalink to this headline">#</a></h2>
<hr class="docutils" />
<p>Make sure that you save this file before you continue, else you will lose everything. To do so, go to <strong>Bestand/File</strong> and click on <strong>Een kopie opslaan in Drive/Save a Copy on Drive</strong>!</p>
<p>Now, rename the file into Week4_Tutorial1.ipynb. You can do so by clicking on the name in the top of this screen.</p>
</section>
<section id="learning-objectives">
<h2>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">#</a></h2>
<hr><ul class="simple">
<li><p>To understand how we can use public data to better understand people’s preferences for leisure.</p></li>
<li><p>To know how to extract data from Flickr using an API.</p></li>
<li><p>To know how to clean and prepare raw data for analysis.</p></li>
<li><p>To know how to cluster geospatial information.</p></li>
<li><p>To visualize clusters and point data in a meaningful way.</p></li>
<li><p>To know how to combine different spatial datasets to gain additional insights.</p></li>
</ul>
<h2>Tutorial Outline<span class="tocSkip"></span></h2>
<hr>
<div class="toc"><ul class="toc-item">
<li><span><a href="#1.-Introducing the packages" data-toc-modified-id="1.-Introducing-the-packages-2">1. Introducing the packages</a></span></li>
<li><span><a href="#2.-Extract data from Flickr" data-toc-modified-id="2.-Extracting-flickr-data-3">2. Extract data from Flickr</a></span></li>
<li><span><a href="#3.-Explore the data" data-toc-modified-id="3.-Explore-Data-4">3. Explore the data</a></span></li>
<li><span><a href="#4.-Clustering of data" data-toc-modified-id="4.-Cluster-data-5">4. Clustering of data</a></span></li>
<li><span><a href="#5.-Do people prefer certain land uses?" data-toc-modified-id="5.-Analyze-buildings-6">5. Do people prefer certain land uses? </a></span></li></ul></div></section>
<section id="introducing-the-packages">
<h2>1.Introducing the packages<a class="headerlink" href="#introducing-the-packages" title="Permalink to this headline">#</a></h2>
<hr><p>Within this tutorial, we are going to make use of the following packages:</p>
<p><a class="reference external" href="https://stuvel.eu/flickrapi-doc/index.html"><strong>flickrapi</strong></a> is a Python interface to the Flickr API. It includes support for authorized and non-authorized access, uploading and replacing photos, and all Flickr API functions.</p>
<p><a class="reference external" href="https://geopandas.org/"><strong>GeoPandas</strong></a> is a Python package that extends the datatypes used by pandas to allow spatial operations on geometric types.</p>
<p><a class="reference external" href="https://numpy.org/doc/stable/"><strong>NumPy</strong></a> is a Python library that provides a multidimensional array object, various derived objects, and an assortment of routines for fast operations on arrays.</p>
<p><a class="reference external" href="https://pandas.pydata.org/docs/"><strong>Pandas</strong></a> is an open source, BSD-licensed library providing high-performance, easy-to-use data structures and data analysis tools for the Python programming language.</p>
<p><a class="reference external" href="https://osmnx.readthedocs.io/"><strong>OSMnx</strong></a> is a Python package that lets you download geospatial data from OpenStreetMap and model, project, visualize, and analyze real-world street networks and any other geospatial geometries. You can download and model walkable, drivable, or bikeable urban networks with a single line of Python code then easily analyze and visualize them. You can just as easily download and work with other infrastructure types, amenities/points of interest, building footprints, elevation data, street bearings/orientations, and speed/travel time.</p>
<p><a class="reference external" href="https://matplotlib.org/"><strong>Matplotlib</strong></a> is a comprehensive Python package for creating static, animated, and interactive visualizations in Python. Matplotlib makes easy things easy and hard things possible.</p>
<p><em>We will first need to install these packages in the cell below. Uncomment them to make sure we can pip install them</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install flickrapi</span>
<span class="c1">#!pip install osmnx</span>
<span class="c1">#!pip install geopandas</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will import these packages in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flickrapi</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pygeos</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">osmnx</span> <span class="k">as</span> <span class="nn">ox</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extract-data-from-flickr">
<h2>2. Extract data from Flickr<a class="headerlink" href="#extract-data-from-flickr" title="Permalink to this headline">#</a></h2>
<hr><p>To extract data from Flicker, we will use their <strong>API</strong>. This is an acronym for application programming interface. It is a software intermediary that allows two applications to talk to each other. APIs are an accessible way to extract and share data within and across organizations. APIs are all around us. Every time you use a rideshare app, send a mobile payment, or change the thermostat temperature from your phone, you’re using an API.</p>
<p>However, before we can access this <strong>API</strong>, we need to take a few steps. Most importantly, we need to register ourselves on the <a class="reference external" href="https://www.flickr.com/">Flickr</a> portal. To do so, we need to register, as explained in the video clip below:</p>
<img src="https://github.com/ElcoK/BigData_AED/blob/main/_static/images/Flickr_registration.gif?raw=1" class="bg-primary mb-1">
<br>
<p>Now, the next step is to access the API. You can now login on the website of <a class="reference external" href="https://www.flickr.com/">Flickr</a>, and go to the <strong>API</strong> part of the <a class="reference external" href="https://www.flickr.com/services/apps/create/apply/">website</a>.</p>
<p>Now click on <code class="docutils literal notranslate"><span class="pre">APPLY</span> <span class="pre">FOR</span> <span class="pre">A</span> <span class="pre">NON-COMMERCIAL</span> <span class="pre">KEY</span></code> and just fill in some information about the course. The name of the App can be something random and related to our big data course, and you just need to fill in two lines of text to describe what you want to do. As soon as you click <code class="docutils literal notranslate"><span class="pre">SUBMIT</span></code>, you will see a generated <strong>api_key</strong> and an <strong>api_secret</strong>. Fill those in below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;d65f682f6f7e8a02a3db8cfbe3c29b15&#39;</span>
<span class="n">api_secret</span><span class="o">=</span><span class="s1">&#39;09f3aa61233e2e11&#39;</span>

<span class="n">flickr</span> <span class="o">=</span> <span class="n">flickrapi</span><span class="o">.</span><span class="n">FlickrAPI</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="prepare-data-extraction">
<h3>Prepare data extraction<a class="headerlink" href="#prepare-data-extraction" title="Permalink to this headline">#</a></h3>
<p>Before we get started with the extraction of data, we need to specify again an area of interest we want to focus on. In the cell below, you will now read “Ameland, The Netherlands”. Change this to any random or municipality in the Netherlands that (1) you can think of and (2) will work.</p>
<p>In some cases, the function does not recognize the location. You could either try a different phrasing or try a different location. Many parts of the Netherlands should work. It is also fine to use an area outside of the Netherlands. I would make sure to not make it too large, as it will take a long time to extract the photos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">place_name</span> <span class="o">=</span> <span class="s2">&quot;Ameland, The Netherlands&quot;</span>
<span class="n">area</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">geocode_to_gdf</span><span class="p">(</span><span class="n">place_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us visualize the bounding box of the area, similar to some of our previous tutorials.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area_to_check</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">area_to_check</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">area_to_check</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="mf">1e6</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">. Total area: </span><span class="si">{}</span><span class="s2"> km2&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">place_name</span><span class="p">,</span><span class="n">size</span><span class="p">),</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Ameland, The Netherlands. Total area: 161 km2&#39;)
</pre></div>
</div>
<img alt="../_images/tutorial2_16_1.png" src="../_images/tutorial2_16_1.png" />
</div>
</div>
</section>
<section id="data-extraction">
<h3>Data extraction<a class="headerlink" href="#data-extraction" title="Permalink to this headline">#</a></h3>
<p>To extract the metadata of the photos from Flickr, we are going to use the <code class="docutils literal notranslate"><span class="pre">.walk()</span></code> function. This function will return a list of photos matching some criteria. It allows you to search photos based on location, date, tag and so on.</p>
<p>In our case, we are state that we want to find all photos, no matter how they are tagged. This is defined through <code class="docutils literal notranslate"><span class="pre">tag_mode=all</span></code>. Moreover, as you will see, we also specify that we want some extra information. More specifically, we ask for the <code class="docutils literal notranslate"><span class="pre">geo(location)</span></code>, <code class="docutils literal notranslate"><span class="pre">tags</span></code>, <code class="docutils literal notranslate"><span class="pre">date_taken</span></code> and the <code class="docutils literal notranslate"><span class="pre">url_m</span></code> of a photo.</p>
<p>We use a bounding box <code class="docutils literal notranslate"><span class="pre">bbox</span></code> to make sure we only select photos from our region of interest. The input requires our bounding box to me in a string format. So let’s do that first.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bbox_string</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">area</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>And now we can extract all the photos. We collect all of them in a list, through the <code class="docutils literal notranslate"><span class="pre">.append()</span></code> function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collect_pictures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="n">flickr</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tag_mode</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span>
                         <span class="c1">#tags=&#39;nature&#39;,</span>
                         <span class="n">bbox</span><span class="o">=</span><span class="n">bbox_string</span><span class="p">,</span><span class="n">extras</span><span class="o">=</span><span class="s1">&#39;geo,tags,date_taken,url_m&#39;</span><span class="p">):</span>
    
    <span class="n">get_attributes</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">attrib</span>
    <span class="n">collect_pictures</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">get_attributes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                             <span class="n">get_attributes</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">],</span>
                             <span class="n">get_attributes</span><span class="p">[</span><span class="s1">&#39;datetaken&#39;</span><span class="p">],</span>
                             <span class="n">get_attributes</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">],</span>
                             <span class="n">get_attributes</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span>
                             <span class="n">get_attributes</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">collect_pictures</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6850
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="explore-the-data">
<h2>3. Explore the data<a class="headerlink" href="#explore-the-data" title="Permalink to this headline">#</a></h2>
<hr>
Now we have extracted the data and, let's explore (and clean) this data a bit more. The convenient thing of having everything stored in a list, is that we can easily turn this into a pandas DataFrame.<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">collect_pictures</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;owner&#39;</span><span class="p">,</span><span class="s1">&#39;datetaken&#39;</span><span class="p">,</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s explore the data a little bit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>owner</th>
      <th>datetaken</th>
      <th>tags</th>
      <th>latitude</th>
      <th>longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>52638191622</td>
      <td>57755771@N05</td>
      <td>2022-08-07 20:02:38</td>
      <td>ameland meer europa vogel wasser tier natur sa...</td>
      <td>53.460438</td>
      <td>5.762622</td>
    </tr>
    <tr>
      <th>1</th>
      <td>51209516215</td>
      <td>26849514@N06</td>
      <td>2021-05-05 19:53:46</td>
      <td>20210505195346 ameland netherlands birdhide bl...</td>
      <td>53.439741</td>
      <td>5.778419</td>
    </tr>
    <tr>
      <th>2</th>
      <td>52637307998</td>
      <td>57755771@N05</td>
      <td>2022-08-08 14:59:24</td>
      <td>ameland meer europa wasser watt fortbewegungsm...</td>
      <td>53.442808</td>
      <td>5.737283</td>
    </tr>
    <tr>
      <th>3</th>
      <td>52633905369</td>
      <td>72056743@N00</td>
      <td>2022-08-13 17:20:14</td>
      <td>img4088 13082022 nederland netherlands ameland...</td>
      <td>53.441900</td>
      <td>5.613400</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52631247150</td>
      <td>191127752@N07</td>
      <td>2023-01-11 14:23:22</td>
      <td>isle island eiland waddeneiland ameland friesl...</td>
      <td>53.448148</td>
      <td>5.630857</td>
    </tr>
    <tr>
      <th>5</th>
      <td>52619820990</td>
      <td>57755771@N05</td>
      <td>2022-08-07 20:16:50</td>
      <td>krabbe sandstrand ameland friesland europa lan...</td>
      <td>53.460438</td>
      <td>5.762622</td>
    </tr>
    <tr>
      <th>6</th>
      <td>52615964065</td>
      <td>21241590@N06</td>
      <td>2023-01-08 14:54:34</td>
      <td></td>
      <td>53.433102</td>
      <td>5.774516</td>
    </tr>
    <tr>
      <th>7</th>
      <td>52615790289</td>
      <td>21241590@N06</td>
      <td>2023-01-08 14:54:02</td>
      <td></td>
      <td>53.433074</td>
      <td>5.774433</td>
    </tr>
    <tr>
      <th>8</th>
      <td>52615527071</td>
      <td>21241590@N06</td>
      <td>2023-01-08 13:25:10</td>
      <td></td>
      <td>53.432938</td>
      <td>5.773597</td>
    </tr>
    <tr>
      <th>9</th>
      <td>52615787459</td>
      <td>21241590@N06</td>
      <td>2023-01-08 12:24:42</td>
      <td></td>
      <td>53.444950</td>
      <td>5.772197</td>
    </tr>
    <tr>
      <th>10</th>
      <td>52616018198</td>
      <td>21241590@N06</td>
      <td>2023-01-08 10:15:01</td>
      <td></td>
      <td>53.460636</td>
      <td>5.779672</td>
    </tr>
    <tr>
      <th>11</th>
      <td>52613321123</td>
      <td>21241590@N06</td>
      <td>2023-01-07 13:06:00</td>
      <td></td>
      <td>53.447686</td>
      <td>5.865030</td>
    </tr>
    <tr>
      <th>12</th>
      <td>52612327127</td>
      <td>21241590@N06</td>
      <td>2023-01-07 12:13:46</td>
      <td></td>
      <td>53.438130</td>
      <td>5.776969</td>
    </tr>
    <tr>
      <th>13</th>
      <td>52612626518</td>
      <td>21241590@N06</td>
      <td>2023-01-06 14:53:17</td>
      <td></td>
      <td>53.441086</td>
      <td>5.638022</td>
    </tr>
    <tr>
      <th>14</th>
      <td>52612140566</td>
      <td>21241590@N06</td>
      <td>2023-01-06 14:01:12</td>
      <td></td>
      <td>53.449250</td>
      <td>5.625780</td>
    </tr>
    <tr>
      <th>15</th>
      <td>52612560985</td>
      <td>21241590@N06</td>
      <td>2023-01-06 13:49:04</td>
      <td></td>
      <td>53.449466</td>
      <td>5.624938</td>
    </tr>
    <tr>
      <th>16</th>
      <td>52612401979</td>
      <td>21241590@N06</td>
      <td>2023-01-06 12:27:33</td>
      <td></td>
      <td>53.436122</td>
      <td>5.717830</td>
    </tr>
    <tr>
      <th>17</th>
      <td>52612138916</td>
      <td>21241590@N06</td>
      <td>2023-01-06 12:20:42</td>
      <td></td>
      <td>53.436055</td>
      <td>5.717447</td>
    </tr>
    <tr>
      <th>18</th>
      <td>52610311021</td>
      <td>57755771@N05</td>
      <td>2022-08-09 21:04:53</td>
      <td>sand ameland meer europa sonne himmel natur ab...</td>
      <td>53.459013</td>
      <td>5.763483</td>
    </tr>
    <tr>
      <th>19</th>
      <td>52609581128</td>
      <td>21241590@N06</td>
      <td>2023-01-05 15:03:54</td>
      <td></td>
      <td>53.465500</td>
      <td>5.931302</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And let’s see if everything is stored in a format in which we can work with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id           object
owner        object
datetaken    object
tags         object
latitude     object
longitude    object
dtype: object
</pre></div>
</div>
</div>
</div>
<p>We would expect floating values for the <strong>latitude</strong> and <strong>longitude</strong>, and a <em>datetime</em> object for the <strong>datetaken</strong>. Let’s have a look how these are stored:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;5.762622&#39;
</pre></div>
</div>
</div>
</div>
<p>Aha! Strings. It will be difficult to convert strings into proper geometries, so let’s convert these columns to floating values, and convert them to <strong>points</strong> using <code class="docutils literal notranslate"><span class="pre">pygeos.points()</span></code>. As you will see, we use a <a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">list comprehension</a> to do so. The input for <code class="docutils literal notranslate"><span class="pre">pygeos.points()</span></code> is a list or numpy array, in which each element contains a <em>longitude</em> and a <em>latitude</em>. To make sure we have that, we create this <code class="docutils literal notranslate"><span class="pre">list</span></code> using the <a class="reference external" href="https://docs.python.org/3.3/library/functions.html#zip">zip</a> function in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pygeos</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]))]</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s convert the <strong>datetaken</strong> column into a <em>datetime</em> type, so we can extract specific years or days.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;datetaken&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">datetaken</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">datetaken</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">datetaken</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;month_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;datetaken&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we have the dates in the correct format, we can plot a figure to identify when most of the photos have been taken/uploaded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/tutorial2_36_1.png" src="../_images/tutorial2_36_1.png" />
</div>
</div>
<p>As we are dealing with spatial data, it would be nice to plot this information on a map. To do so, we convert our <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> into a <code class="docutils literal notranslate"><span class="pre">geopandas.GeoDataFrame</span></code>. Moreover, we have to specify the coordinate reference system. Given that we have a global dataset, it makes most sense to use <strong>epsg:4326</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;epsg:4326&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_to_plot</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1">#ax.set_title(&quot;{}. Total area: {} km2&quot;.format(place_name,size),fontweight=&#39;bold&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/tutorial2_39_0.png" src="../_images/tutorial2_39_0.png" />
</div>
</div>
<p>Let’s have a look how all these photos are tagged. And whether we can actually do something with this information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       ameland meer europa vogel wasser tier natur sa...
1       20210505195346 ameland netherlands birdhide bl...
2       ameland meer europa wasser watt fortbewegungsm...
3       img4088 13082022 nederland netherlands ameland...
4       isle island eiland waddeneiland ameland friesl...
                              ...                        
6845    ameland meer europa wasser watt fortbewegungsm...
6846    aussicht ameland friesland europa meer wasser ...
6847    himmel jahreszeiten sonnenuntergang pflanzen a...
6848    leuchtturm ameland farbe europa jahreszeiten n...
6849    europa ameland friesland jahreszeiten wattenme...
Name: tags, Length: 6850, dtype: object
</pre></div>
</div>
</div>
</div>
<p>This looks like a mess. It seems we have some work to do to be able to use some of this. Lets get an overview of all the tags and get an idea how often certain tags are used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">find_all_tags</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
    <span class="n">find_all_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    
<span class="n">all_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">find_all_tags</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">all_tags</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ameland          4208
kevinscottorg    2254
kevinscott       2254
beachrugby       2254
rugby            2214
netherlands      2197
rc               2156
rfc              2137
friesland        1483
nederland        1369
2017             1265
niederlande      1265
itamelân          958
jahreszeiten      957
europa            957
sommer            957
fryslân           955
europe            949
natur             934
summer            916
abrf17            863
country           847
lacampagne        845
lespaysbas        845
lasaison          845
ilpaese           845
nederlân          845
lestate           845
seasons           845
lété              845
abrf18            756
sea               722
meer              695
wasser            693
ocean             660
water             585
mare              581
2018              581
waters            581
lacqua            581
leau              581
leseaux           581
lamer             581
gewässer          581
landschaft        450
nordsee           446
amsterdamaac      431
pflanzen          414
dünengras         413
landscape         403
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>So we see that quite a lot of the tags don’t really say much about the area or why people might visit the area. Let’s give it a go by just trying to see how many pictures are tagged in something linked to nature. Add more words if you believe you can identify more in the previous overview.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_nature_tags</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;seehund&quot;</span><span class="p">,</span> <span class="s2">&quot;zeehond&quot;</span><span class="p">,</span><span class="s2">&quot;vis&quot;</span><span class="p">,</span><span class="s2">&quot;wadden&quot;</span><span class="p">,</span>
               <span class="s2">&quot;natuur&quot;</span><span class="p">,</span><span class="s2">&quot;nature&quot;</span><span class="p">,</span><span class="s2">&quot;natur&quot;</span><span class="p">,</span>
               <span class="s2">&quot;landschaft&quot;</span><span class="p">,</span>
               <span class="s2">&quot;strand&quot;</span><span class="p">,</span><span class="s2">&quot;beach&quot;</span><span class="p">,</span><span class="s2">&quot;zee&quot;</span><span class="p">,</span><span class="s2">&quot;sea&quot;</span><span class="p">,</span><span class="s2">&quot;meer&quot;</span><span class="p">,</span>
               <span class="s2">&quot;bos&quot;</span><span class="p">,</span><span class="s2">&quot;forest&quot;</span><span class="p">,</span>
               <span class="s2">&quot;animal&quot;</span><span class="p">,</span><span class="s2">&quot;bird&quot;</span><span class="p">,</span><span class="s2">&quot;vogel&quot;</span><span class="p">,</span><span class="s2">&quot;dier&quot;</span><span class="p">]</span>

    <span class="n">overlap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matches</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;yes&#39;</span>
    
<span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;nature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">find_nature_tags</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s count them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">nature</span><span class="o">==</span><span class="s1">&#39;yes&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1287
</pre></div>
</div>
</div>
</div>
<p>And let’s only plot those points on a map</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_to_plot</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
<span class="n">gdf_to_plot</span> <span class="o">=</span> <span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">]</span>
<span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#ax.set_xticks([])</span>
<span class="c1">#ax.set_yticks([])</span>
<span class="c1">#ax.set_axis_off()</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1">#ax.set_title(&quot;{}. Total area: {} km2&quot;.format(place_name,size),fontweight=&#39;bold&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/tutorial2_49_0.png" src="../_images/tutorial2_49_0.png" />
</div>
</div>
<p>What we also noticed is that some users seems to upload quite a lot of pictures. Let’s have a look at the amount of unique users in this area:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>57755771@N05     933
132646954@N02     75
20829994@N04      44
88330064@N07      37
22049393@N02      32
27998473@N02      30
146166548@N02     30
60057960@N06      13
87128103@N00      12
105105658@N03     10
149261879@N02      6
145258783@N06      6
53405320@N00       6
85710548@N07       4
8866365@N08        4
91358374@N06       4
101219331@N02      3
13521837@N00       3
12593590@N06       3
97917374@N04       3
59924487@N04       3
132078928@N04      2
117731235@N07      2
23171095@N05       2
169760497@N06      2
64056310@N05       1
22858517@N08       1
24571671@N08       1
141380219@N03      1
21687857@N00       1
21538273@N07       1
162033351@N07      1
27494769@N08       1
63991153@N00       1
11803260@N04       1
87789292@N06       1
137830686@N03      1
140905559@N06      1
47409511@N00       1
72056743@N00       1
44300154@N08       1
156227259@N08      1
14925782@N06       1
Name: owner, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>And have a look at one of the users with the most pictures</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="s1">&#39;57755771@N05&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>owner</th>
      <th>datetaken</th>
      <th>tags</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>geometry</th>
      <th>year</th>
      <th>month</th>
      <th>month_year</th>
      <th>nature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>52638191622</td>
      <td>57755771@N05</td>
      <td>2022-08-07 20:02:38</td>
      <td>ameland meer europa vogel wasser tier natur sa...</td>
      <td>53.460438</td>
      <td>5.762622</td>
      <td>POINT (641492.147 7068624.806)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>52637307998</td>
      <td>57755771@N05</td>
      <td>2022-08-08 14:59:24</td>
      <td>ameland meer europa wasser watt fortbewegungsm...</td>
      <td>53.442808</td>
      <td>5.737283</td>
      <td>POINT (638671.422 7065329.158)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>52619820990</td>
      <td>57755771@N05</td>
      <td>2022-08-07 20:16:50</td>
      <td>krabbe sandstrand ameland friesland europa lan...</td>
      <td>53.460438</td>
      <td>5.762622</td>
      <td>POINT (641492.147 7068624.806)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>52610311021</td>
      <td>57755771@N05</td>
      <td>2022-08-09 21:04:53</td>
      <td>sand ameland meer europa sonne himmel natur ab...</td>
      <td>53.459013</td>
      <td>5.763483</td>
      <td>POINT (641587.993 7068358.374)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52590938986</td>
      <td>57755771@N05</td>
      <td>2022-08-13 21:12:57</td>
      <td>himmel jahreszeiten sonnenuntergang pflanzen a...</td>
      <td>53.459094</td>
      <td>5.763408</td>
      <td>POINT (641579.644 7068373.518)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1282</th>
      <td>52551866537</td>
      <td>57755771@N05</td>
      <td>2022-08-07 20:07:42</td>
      <td>bohrinse landschaft strand aussicht ameland fr...</td>
      <td>53.460438</td>
      <td>5.762622</td>
      <td>POINT (641492.147 7068624.806)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1283</th>
      <td>52548953936</td>
      <td>57755771@N05</td>
      <td>2022-08-08 15:02:41</td>
      <td>ameland meer europa wasser watt fortbewegungsm...</td>
      <td>53.442808</td>
      <td>5.737283</td>
      <td>POINT (638671.422 7065329.158)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1284</th>
      <td>52544288227</td>
      <td>57755771@N05</td>
      <td>2022-08-11 11:58:23</td>
      <td>aussicht ameland friesland europa meer wasser ...</td>
      <td>53.457505</td>
      <td>5.903197</td>
      <td>POINT (657140.884 7068076.433)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1285</th>
      <td>52541369571</td>
      <td>57755771@N05</td>
      <td>2022-08-13 21:07:58</td>
      <td>himmel jahreszeiten sonnenuntergang pflanzen a...</td>
      <td>53.459094</td>
      <td>5.763408</td>
      <td>POINT (641579.644 7068373.518)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1286</th>
      <td>52531223922</td>
      <td>57755771@N05</td>
      <td>2022-08-08 14:17:07</td>
      <td>europa ameland friesland jahreszeiten wattenme...</td>
      <td>53.438838</td>
      <td>5.641583</td>
      <td>POINT (628018.147 7064587.218)</td>
      <td>2022</td>
      <td>Aug</td>
      <td>2022-08</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
<p>933 rows × 11 columns</p>
</div></div></div>
</div>
<p>Ok, so it seems that we have several users that dominate the amount of uploads. If we want to say something about the preference of locations to visit, we might have to compensate for this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_unique</span> <span class="o">=</span> <span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;owner&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="s1">&#39;nature&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_unique</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>owner</th>
      <th>latitude</th>
      <th>nature</th>
      <th>id</th>
      <th>datetaken</th>
      <th>tags</th>
      <th>longitude</th>
      <th>geometry</th>
      <th>year</th>
      <th>month</th>
      <th>month_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>101219331@N02</td>
      <td>53.435752</td>
      <td>yes</td>
      <td>31974222218</td>
      <td>2018-11-02 17:37:25</td>
      <td>ameland nature nederland storm waddenzee</td>
      <td>5.776600</td>
      <td>POINT (643048.171 7064010.534)</td>
      <td>2018</td>
      <td>Nov</td>
      <td>2018-11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>101219331@N02</td>
      <td>53.440252</td>
      <td>yes</td>
      <td>45796060332</td>
      <td>2018-11-02 11:52:07</td>
      <td>ameland nature nederland ocean waddenzee</td>
      <td>5.757375</td>
      <td>POINT (640908.053 7064851.468)</td>
      <td>2018</td>
      <td>Nov</td>
      <td>2018-11</td>
    </tr>
    <tr>
      <th>2</th>
      <td>101219331@N02</td>
      <td>53.446386</td>
      <td>yes</td>
      <td>44932422835</td>
      <td>2018-11-02 14:58:35</td>
      <td>ameland beach nederland ocean</td>
      <td>5.614552</td>
      <td>POINT (625009.070 7065997.897)</td>
      <td>2018</td>
      <td>Nov</td>
      <td>2018-11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>105105658@N03</td>
      <td>53.427027</td>
      <td>yes</td>
      <td>51805477424</td>
      <td>2021-09-22 17:33:37</td>
      <td>ameland ccby nederland thenetherlands wadden r...</td>
      <td>5.646208</td>
      <td>POINT (628532.999 7062380.311)</td>
      <td>2021</td>
      <td>Sep</td>
      <td>2021-09</td>
    </tr>
    <tr>
      <th>4</th>
      <td>105105658@N03</td>
      <td>53.437911</td>
      <td>yes</td>
      <td>51617379718</td>
      <td>2021-09-21 19:32:55</td>
      <td>ameland ccby nederland thenetherlands wadden r...</td>
      <td>5.805708</td>
      <td>POINT (646288.458 7064413.984)</td>
      <td>2021</td>
      <td>Sep</td>
      <td>2021-09</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>168</th>
      <td>8866365@N08</td>
      <td>53.451388</td>
      <td>yes</td>
      <td>51158447412</td>
      <td>2020-06-03 17:14:27</td>
      <td>hollum ameland friesland nederland strand beach</td>
      <td>5.614979</td>
      <td>POINT (625056.603 7066932.881)</td>
      <td>2020</td>
      <td>Jun</td>
      <td>2020-06</td>
    </tr>
    <tr>
      <th>169</th>
      <td>8866365@N08</td>
      <td>53.451528</td>
      <td>yes</td>
      <td>51159893629</td>
      <td>2020-06-03 17:09:16</td>
      <td>hollum ameland friesland nederland strand beach</td>
      <td>5.614871</td>
      <td>POINT (625044.581 7066959.052)</td>
      <td>2020</td>
      <td>Jun</td>
      <td>2020-06</td>
    </tr>
    <tr>
      <th>170</th>
      <td>91358374@N06</td>
      <td>53.427802</td>
      <td>yes</td>
      <td>50123100142</td>
      <td>2020-06-24 13:26:51</td>
      <td>ameland bloemenenplanten kanoet vogel hollum f...</td>
      <td>5.642449</td>
      <td>POINT (628114.550 7062525.102)</td>
      <td>2020</td>
      <td>Jun</td>
      <td>2020-06</td>
    </tr>
    <tr>
      <th>171</th>
      <td>91358374@N06</td>
      <td>53.433522</td>
      <td>yes</td>
      <td>50123100137</td>
      <td>2020-06-24 13:31:20</td>
      <td>ameland bloemenenplanten kanoet vogel hollum f...</td>
      <td>5.640602</td>
      <td>POINT (627908.942 7063593.838)</td>
      <td>2020</td>
      <td>Jun</td>
      <td>2020-06</td>
    </tr>
    <tr>
      <th>172</th>
      <td>97917374@N04</td>
      <td>53.459616</td>
      <td>yes</td>
      <td>45661262425</td>
      <td>2016-06-05 13:57:30</td>
      <td>wulp ameland waddeneilanden wadden numeniusarq...</td>
      <td>5.819320</td>
      <td>POINT (647803.739 7068471.115)</td>
      <td>2016</td>
      <td>Jun</td>
      <td>2016-06</td>
    </tr>
  </tbody>
</table>
<p>173 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="clustering-of-data">
<h2>4. Clustering of data<a class="headerlink" href="#clustering-of-data" title="Permalink to this headline">#</a></h2>
<hr><p>As it is pretty difficult to see any patterns on the maps above, let’s try to cluster some of this information and see if this helps us to better understand why people choose to visit certain locations in the area.</p>
<section id="create-a-grid-of-the-area">
<h3>Create a grid of the area<a class="headerlink" href="#create-a-grid-of-the-area" title="Permalink to this headline">#</a></h3>
<p>The most simple way would be to collect all points within a grid. The <code class="docutils literal notranslate"><span class="pre">create_grid()</span></code> function below will help us to create a evenly-distributed grid within any given area. So let’s use that!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_grid</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span><span class="n">height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a vector-based grid</span>
<span class="sd">    Args:</span>
<span class="sd">        bbox ([type]): [description]</span>
<span class="sd">        height ([type]): [description]</span>
<span class="sd">    Returns:</span>
<span class="sd">        [type]: [description]</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="c1"># set xmin,ymin,xmax,and ymax of the grid</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">(</span><span class="n">bbox</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pygeos</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">(</span><span class="n">bbox</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">(</span><span class="n">bbox</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span><span class="n">pygeos</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">(</span><span class="n">bbox</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
    
    <span class="c1">#estimate total rows and columns</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="n">height</span><span class="p">))</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">height</span><span class="p">))</span>

    <span class="c1"># set corner points</span>
    <span class="n">x_left_origin</span> <span class="o">=</span> <span class="n">xmin</span>
    <span class="n">x_right_origin</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="n">height</span>
    <span class="n">y_top_origin</span> <span class="o">=</span> <span class="n">ymax</span>
    <span class="n">y_bottom_origin</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">height</span>

    <span class="c1"># create actual grid</span>
    <span class="n">res_geoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">countcols</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">y_top</span> <span class="o">=</span> <span class="n">y_top_origin</span>
        <span class="n">y_bottom</span> <span class="o">=</span> <span class="n">y_bottom_origin</span>
        <span class="k">for</span> <span class="n">countrows</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">res_geoms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                <span class="p">((</span><span class="n">x_left_origin</span><span class="p">,</span> <span class="n">y_top</span><span class="p">),</span> <span class="p">(</span><span class="n">x_right_origin</span><span class="p">,</span> <span class="n">y_top</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x_right_origin</span><span class="p">,</span> <span class="n">y_bottom</span><span class="p">),</span> <span class="p">(</span><span class="n">x_left_origin</span><span class="p">,</span> <span class="n">y_bottom</span><span class="p">)</span>
                <span class="p">)))</span>
            <span class="n">y_top</span> <span class="o">=</span> <span class="n">y_top</span> <span class="o">-</span> <span class="n">height</span>
            <span class="n">y_bottom</span> <span class="o">=</span> <span class="n">y_bottom</span> <span class="o">-</span> <span class="n">height</span>
        <span class="n">x_left_origin</span> <span class="o">=</span> <span class="n">x_left_origin</span> <span class="o">+</span> <span class="n">height</span>
        <span class="n">x_right_origin</span> <span class="o">=</span> <span class="n">x_right_origin</span> <span class="o">+</span> <span class="n">height</span>

    <span class="k">return</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">polygons</span><span class="p">(</span><span class="n">res_geoms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">create_grid</span><span class="p">(</span><span class="n">pygeos</span><span class="o">.</span><span class="n">from_shapely</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">geometry</span><span class="p">),</span><span class="mf">0.005</span><span class="p">),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/tutorial2_62_1.png" src="../_images/tutorial2_62_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">grid</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;epsg:4326&#39;</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">STRtree</span><span class="p">(</span><span class="n">pygeos</span><span class="o">.</span><span class="n">from_shapely</span><span class="p">(</span><span class="n">gdf_unique</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_unique</span><span class="o">.</span><span class="n">nature</span><span class="o">==</span><span class="s1">&#39;yes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;nature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">pygeos</span><span class="o">.</span><span class="n">from_shapely</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;contains_properly&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid</span><span class="o">.</span><span class="n">nature</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">grid</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;nature&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1">#ax.set_xticks([])</span>
<span class="c1">#ax.set_yticks([])</span>
<span class="c1">#ax.set_axis_off()</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1">#ax.set_title(&quot;{}. Total area: {} km2&quot;.format(place_name,size),fontweight=&#39;bold&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/tutorial2_66_01.png" src="../_images/tutorial2_66_01.png" />
</div>
</div>
</section>
<section id="dbscan">
<h3>DBSCAN<a class="headerlink" href="#dbscan" title="Permalink to this headline">#</a></h3>
<p>The DBSCAN algorithm views clusters as areas of high density separated by areas of low density. Due to this rather generic view, clusters found by DBSCAN can be any shape. The central component to the DBSCAN is the concept of <strong>core samples</strong>, which are samples that are in areas of <em>high density</em>. A cluster is therefore a set of <strong>core samples</strong>, each close to each other (measured by some distance measure) and a set of <em>non-core samples</em> that are close to a <strong>core sample</strong> (but are not themselves core samples). There are two parameters to the algorithm, <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> and <code class="docutils literal notranslate"><span class="pre">eps</span></code>, which define formally what we mean when we say dense. Higher <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> or <code class="docutils literal notranslate"><span class="pre">lower</span> <span class="pre">eps</span></code> indicate higher density necessary to form a cluster.</p>
<p>More formally, we define a <strong>core sample</strong> as being a sample in the dataset such that there exist <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> other samples within a distance of <code class="docutils literal notranslate"><span class="pre">eps</span></code>, which are defined as neighbors of the <strong>core sample</strong>. This tells us that the <strong>core sample</strong> is in a dense area of the vector space. A cluster is a set of <strong>core samples</strong> that can be built by recursively taking a <strong>core sample</strong>, finding all of its neighbors that are <strong>core samples</strong>, finding all of their neighbors that are <strong>core samples</strong>, and so on. A cluster also has a set of <em>non-core samples</em>, which are samples that are neighbors of a <strong>core sample</strong> in the cluster but are not themselves <strong>core samples</strong>. Intuitively, these samples are on the fringes of a cluster.</p>
<p>Any <strong>core sample</strong> is part of a cluster, by definition. Any sample that is <em>not</em> a <strong>core sample</strong>, and is at least <code class="docutils literal notranslate"><span class="pre">eps</span></code> in distance from any <strong>core sample</strong>, is considered an outlier by the algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">gdf_to_plot</span><span class="p">[[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">gdf_to_plot</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1">#/ kms_per_radian</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;ball_tree&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">((</span><span class="n">coords</span><span class="p">))</span> <span class="c1">#, metric=&#39;haversine&#39;</span>
<span class="n">cluster_labels</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">labels_</span>
<span class="n">num_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">))</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">cluster_labels</span> <span class="o">==</span> <span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">cluster_labels</span> <span class="o">==</span> <span class="n">n</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of clusters: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of clusters: 57
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">convex_hull</span><span class="p">(</span><span class="n">pygeos</span><span class="o">.</span><span class="n">multipoints</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
<span class="n">cluster_gdf</span><span class="p">[</span><span class="s1">&#39;cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">cluster_gdf</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">cluster_gdf</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_to_plot</span> <span class="o">=</span> <span class="n">cluster_gdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cluster_to_plot</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;epsg:4326&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_to_plot</span> <span class="o">=</span> <span class="n">cluster_gdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cluster_to_plot</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;epsg:3857&#39;</span>
<span class="c1">#cluster_to_plot.reset_index(drop=True,inplace=True)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">cluster_to_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;cluster_size&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1">#ax.set_xticks([])</span>
<span class="c1">#ax.set_yticks([])</span>
<span class="c1">#ax.set_axis_off()</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/tutorial2_73_0.png" src="../_images/tutorial2_73_0.png" />
</div>
</div>
</section>
</section>
<section id="do-people-prefer-certain-land-uses">
<h2>5. Do people prefer certain land uses?<a class="headerlink" href="#do-people-prefer-certain-land-uses" title="Permalink to this headline">#</a></h2>
<hr><p>We already started to understand our data a little bit better. However, it would be interesting to combine this with some land-use information, to see if we can find some patterns over there.</p>
<p>Let’s use the land-use information from OpenStreetMap to do so (similar to Tutorial 1 in Week 4). As you will see in the cell below, we use the tags <em>“landuse”</em> and <em>“natural”</em>. We need to use the <em>“natural”</em> tag to ensure we also obtain water bodies and other natural elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;landuse&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;natural&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>   
<span class="n">landuse</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">geometries_from_place</span><span class="p">(</span><span class="n">place_name</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To ensure we really only get the area that we want, we use geopandas’s <code class="docutils literal notranslate"><span class="pre">clip</span></code> function to only keep the area we want. This function does exactly the same as the <code class="docutils literal notranslate"><span class="pre">clip</span></code> function in QGIS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landuse</span> <span class="o">=</span> <span class="n">landuse</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To more easily work with the data, we want all information in a single column. However, at the moment, all information that was tagged as <em>“natural”</em>, has no information stored in the <em>“landuse”</em> tags. It is, however, very convenient if we can just use a single column for further exploration of the data.</p>
<p>To overcome this issue, we need to add the missing information to the landuse column, as done below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;wetland&#39;, &#39;coastline&#39;, &#39;beach&#39;, &#39;shoal&#39;, &#39;scrub&#39;, nan, &#39;water&#39;,
       &#39;sand&#39;, &#39;grassland&#39;, &#39;tree&#39;, &#39;heath&#39;, &#39;wood&#39;, &#39;peak&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;water&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;water&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;beach&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;beach&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;grassland&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grass&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;wetland&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;wetlands&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;coastline&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;coastline&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;shoal&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;shoal&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;scrub&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;scrub&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;sand&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sand&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tree&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;heath&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;heath&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;wood&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;wood&#39;</span>
<span class="n">landuse</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">landuse</span><span class="o">.</span><span class="n">natural</span><span class="o">==</span><span class="s1">&#39;peak&#39;</span><span class="p">,</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;peak&#39;</span>

<span class="n">landuse</span> <span class="o">=</span> <span class="n">landuse</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;landuse&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landuse</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;epsg:4326&#39;</span>
<span class="n">landuse</span> <span class="o">=</span> <span class="n">landuse</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:3857&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s overlap this landuse information with our photos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landuse</span> <span class="o">=</span> <span class="n">landuse</span><span class="p">[(</span><span class="n">landuse</span><span class="o">.</span><span class="n">geom_type</span> <span class="o">==</span> <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">landuse</span><span class="o">.</span><span class="n">geom_type</span> <span class="o">==</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">landuse</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;landuse&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ncol&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/tutorial2_85_0.png" src="../_images/tutorial2_85_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_landuse</span> <span class="o">=</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">STRtree</span><span class="p">(</span><span class="n">pygeos</span><span class="o">.</span><span class="n">from_shapely</span><span class="p">(</span><span class="n">landuse</span><span class="o">.</span><span class="n">geometry</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_landuse</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">landuse</span><span class="p">):</span>
    
    <span class="n">intersect</span> <span class="o">=</span> <span class="p">(</span><span class="n">tree_landuse</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">pygeos</span><span class="o">.</span><span class="n">from_shapely</span><span class="p">(</span><span class="n">row</span><span class="p">),</span><span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;intersects&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;water&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">landuse</span><span class="o">.</span><span class="n">landuse</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">intersect</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span><span class="p">[</span><span class="s1">&#39;landuse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">find_landuse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">landuse</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;landuse&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nature</th>
    </tr>
    <tr>
      <th>landuse</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>beach</th>
      <td>43</td>
    </tr>
    <tr>
      <th>forest</th>
      <td>24</td>
    </tr>
    <tr>
      <th>grass</th>
      <td>26</td>
    </tr>
    <tr>
      <th>heath</th>
      <td>1</td>
    </tr>
    <tr>
      <th>meadow</th>
      <td>5</td>
    </tr>
    <tr>
      <th>residential</th>
      <td>4</td>
    </tr>
    <tr>
      <th>sand</th>
      <td>25</td>
    </tr>
    <tr>
      <th>scrub</th>
      <td>18</td>
    </tr>
    <tr>
      <th>water</th>
      <td>11</td>
    </tr>
    <tr>
      <th>wetlands</th>
      <td>16</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./week6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="tutorial1.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Tutorial 1: Social Media and Natural Language Processing</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../week7/lecture.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture: A guide to visualisation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dr Elco Koks & Dr Thales Pupo-West<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>